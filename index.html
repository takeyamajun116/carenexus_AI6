<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareNexus Audit - 経営監査クラウド</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; }
        .drag-active { border-color: #3B82F6; background-color: #EFF6FF; }
        .blur-in { animation: blurIn 0.5s ease-out forwards; }
        @keyframes blurIn { from { filter: blur(5px); opacity: 0; } to { filter: blur(0); opacity: 1; } }
        /* Watermark style for the preview */
        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 5rem; color: rgba(200, 0, 0, 0.1); font-weight: bold; pointer-events: none; white-space: nowrap;}
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-white shadow-sm border-b border-gray-200 fixed w-full z-10 top-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-2">
                    <div class="bg-blue-600 text-white p-1.5 rounded-lg">
                        <i class="fa-solid fa-file-medical-alt text-xl"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tight text-gray-900">CareNexus <span class="text-blue-600 font-light">Audit</span></span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">Pro Plan</span>
                    <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold border border-blue-200">
                        S
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-5xl mx-auto min-h-screen">
        
        <div id="view-upload" class="blur-in">
            <div class="text-center mb-10">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">レセコンデータを取り込む</h1>
                <p class="text-gray-500">お使いのレセコンから出力したCSVをアップロードしてください。<br>iBow, カイポケ, ワイズマン等の形式を自動認識します。</p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-10 max-w-3xl mx-auto">
                <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-xl p-12 text-center transition-all cursor-pointer hover:border-blue-400 hover:bg-gray-50 group" onclick="simulateUpload()">
                    <div class="mb-4">
                        <div class="h-16 w-16 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto group-hover:scale-110 transition-transform">
                            <i class="fa-solid fa-cloud-upload-alt text-3xl"></i>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-700">CSVファイルをここにドラッグ＆ドロップ</h3>
                    <p class="text-sm text-gray-400 mt-2">またはクリックしてファイルを選択</p>
                    <div class="mt-6 flex justify-center gap-3">
                        <span class="px-2 py-1 text-xs bg-gray-100 text-gray-500 rounded">利用者台帳.csv</span>
                        <span class="px-2 py-1 text-xs bg-gray-100 text-gray-500 rounded">実績明細.csv</span>
                    </div>
                </div>
                
                <div class="mt-6 flex items-start gap-3 bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <i class="fa-solid fa-shield-halved text-blue-600 mt-1"></i>
                    <div>
                        <p class="text-sm font-semibold text-blue-800">セキュリティ保護中</p>
                        <p class="text-xs text-blue-600">アップロードされた個人情報は暗号化され、監査完了後に自動的に破棄されます。</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-processing" class="hidden text-center pt-20">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-6"></div>
            <h2 class="text-2xl font-bold text-gray-800">監査エンジンを実行中...</h2>
            <p class="text-gray-500 mt-2" id="process-status">CSVフォーマットを解析しています</p>
            
            <div class="max-w-md mx-auto mt-8 bg-white rounded-lg shadow-sm p-4 text-left border border-gray-100">
                <div class="space-y-3">
                    <div class="flex items-center text-sm text-gray-600">
                        <i class="fa-solid fa-check-circle text-green-500 mr-2"></i> データクレンジング完了
                    </div>
                    <div class="flex items-center text-sm text-gray-600 opacity-50" id="step-2">
                        <i class="fa-solid fa-circle text-gray-300 mr-2"></i> 算定要件ロジック照合 (厚労省告示 第52号)
                    </div>
                    <div class="flex items-center text-sm text-gray-600 opacity-50" id="step-3">
                        <i class="fa-solid fa-circle text-gray-300 mr-2"></i> 埋没収益の算出
                    </div>
                </div>
            </div>
        </div>

        <div id="view-dashboard" class="hidden blur-in">
            <div class="flex justify-between items-end mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">2024年1月度 監査レポート</h2>
                    <p class="text-gray-500 text-sm">解析対象: 利用者84名</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-500 mb-1">発見された月間埋没収益</p>
                    <div class="text-4xl font-bold text-red-500 flex items-center gap-2">
                        <i class="fa-solid fa-arrow-trend-up text-2xl"></i>
                        ¥245,600
                    </div>
                    <p class="text-xs text-gray-400">年間換算: ¥2,947,200 の増収効果</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-red-500 relative overflow-hidden">
                    <div class="absolute top-2 right-2 bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full font-bold">要対応</div>
                    <h3 class="text-gray-500 text-sm font-semibold mb-1">特別管理加算 (II)</h3>
                    <p class="text-2xl font-bold text-gray-800">3名 未算定</p>
                    <p class="text-xs text-gray-400 mt-2">対象: 佐藤様, 他2名</p>
                    <p class="text-xs text-red-500 mt-1 font-semibold">+ ¥15,000 / 月</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-orange-400">
                    <div class="absolute top-2 right-2 bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-full font-bold">確認推奨</div>
                    <h3 class="text-gray-500 text-sm font-semibold mb-1">緊急時訪問看護加算</h3>
                    <p class="text-2xl font-bold text-gray-800">5名 契約不備</p>
                    <p class="text-xs text-gray-400 mt-2">同意書の日付が期限切れの可能性</p>
                    <p class="text-xs text-orange-500 mt-1 font-semibold">返戻リスクあり</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500">
                    <h3 class="text-gray-500 text-sm font-semibold mb-1">ベースアップ評価料</h3>
                    <p class="text-2xl font-bold text-gray-800">区分変更可能</p>
                    <p class="text-xs text-gray-400 mt-2">現在の職員配置なら区分(I)→(II)へ</p>
                    <p class="text-xs text-blue-500 mt-1 font-semibold">+ ¥80,000 / 月</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-8">
                <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                    <h3 class="font-bold text-gray-800">詳細監査リスト</h3>
                    <button class="text-sm text-blue-600 hover:underline">CSVでダウンロード</button>
                </div>
                <table class="w-full text-sm text-left text-gray-600">
                    <thead class="bg-gray-50 text-xs uppercase text-gray-500">
                        <tr>
                            <th class="px-6 py-3">利用者名</th>
                            <th class="px-6 py-3">検知内容</th>
                            <th class="px-6 py-3">根拠法令・理由</th>
                            <th class="px-6 py-3">アクション</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 font-medium text-gray-900">佐藤 健一 様<br><span class="text-xs text-gray-400">要介護3 / 褥瘡あり</span></td>
                            <td class="px-6 py-4 text-red-600 font-bold">特別管理加算 漏れ</td>
                            <td class="px-6 py-4 max-w-xs">
                                真皮を超える褥瘡処置の実績があるが、加算コードが含まれていません。
                                <a href="#" class="text-blue-500 text-xs underline block mt-1">告示52号 算定要件を確認</a>
                            </td>
                            <td class="px-6 py-4">
                                <button onclick="openLegalModal('佐藤 健一', '特別管理加算に係る届出書')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md text-xs font-bold shadow transition">
                                    届出ドラフト作成
                                </button>
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 font-medium text-gray-900">田中 良子 様<br><span class="text-xs text-gray-400">要介護5 / 難病</span></td>
                            <td class="px-6 py-4 text-orange-600 font-bold">保険種別の誤り</td>
                            <td class="px-6 py-4 max-w-xs">
                                パーキンソン病（Yahr IV）のため、介護保険ではなく医療保険適用の可能性があります。
                            </td>
                            <td class="px-6 py-4">
                                <button class="bg-white border border-gray-300 text-gray-600 hover:bg-gray-50 px-3 py-1.5 rounded-md text-xs font-bold transition">
                                    主治医確認書 DL
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <div id="legal-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full mx-4 overflow-hidden animate-bounce-in">
            <div class="bg-gray-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-800">
                    <i class="fa-solid fa-file-signature text-blue-600 mr-2"></i>
                    届出書ドラフトの作成
                </h3>
                <button onclick="closeLegalModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-times"></i></button>
            </div>
            
            <div class="p-6">
                <div class="bg-gray-100 border border-gray-300 p-4 rounded mb-6 relative h-32 flex items-center justify-center">
                    <div class="text-center">
                        <i class="fa-regular fa-file-pdf text-4xl text-gray-400 mb-2"></i>
                        <p class="text-sm font-bold text-gray-600" id="modal-doc-title">特別管理加算に係る届出書</p>
                        <p class="text-xs text-gray-400">対象: 佐藤 健一 様</p>
                    </div>
                    <div class="watermark">DRAFT</div>
                </div>

                <div class="space-y-4">
                    <p class="text-sm text-gray-600 font-bold mb-2">以下を確認し、チェックを入れてください（必須）</p>
                    
                    <label class="flex items-start gap-3 p-3 rounded-lg border border-gray-200 hover:bg-blue-50 cursor-pointer transition">
                        <input type="checkbox" id="check1" class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onchange="validateChecks()">
                        <span class="text-sm text-gray-700">システムが提示した算定要件（褥瘡の状態等）が、実際の利用者の状態と一致していることを確認しました。</span>
                    </label>

                    <label class="flex items-start gap-3 p-3 rounded-lg border border-gray-200 hover:bg-blue-50 cursor-pointer transition">
                        <input type="checkbox" id="check2" class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onchange="validateChecks()">
                        <span class="text-sm text-gray-700">本機能は「作成支援」であり、最終的な申請と提出は事業所の責任において行うことを理解しました。</span>
                    </label>
                </div>
            </div>

            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-3">
                <button onclick="closeLegalModal()" class="px-4 py-2 text-gray-600 text-sm font-bold hover:bg-gray-200 rounded-lg transition">キャンセル</button>
                <button id="btn-download" disabled onclick="downloadSuccess()" class="px-6 py-2 bg-gray-400 text-white text-sm font-bold rounded-lg shadow-sm cursor-not-allowed transition flex items-center gap-2">
                    <i class="fa-solid fa-download"></i>
                    ドラフトをDL
                </button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-5 right-5 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-300 flex items-center gap-3">
        <i class="fa-solid fa-circle-check text-green-400"></i>
        <div>
            <p class="font-bold text-sm">ダウンロード完了</p>
            <p class="text-xs text-gray-400">印刷して内容を確認の上、提出してください。</p>
        </div>
    </div>

    <script>
        // Simulation: Upload Process
        function simulateUpload() {
            const dropZone = document.getElementById('drop-zone');
            
            // Visual feedback
            dropZone.classList.add('bg-blue-50', 'border-blue-500');
            dropZone.innerHTML = '<div class="text-blue-600"><i class="fa-solid fa-circle-notch fa-spin text-3xl mb-2"></i><p class="font-bold">アップロード中...</p></div>';

            setTimeout(() => {
                // Switch to Processing View
                document.getElementById('view-upload').classList.add('hidden');
                document.getElementById('view-processing').classList.remove('hidden');
                document.getElementById('view-processing').classList.add('blur-in');

                // Simulate progress steps
                setTimeout(() => {
                    document.getElementById('step-2').classList.remove('opacity-50');
                    document.getElementById('step-2').innerHTML = '<i class="fa-solid fa-check-circle text-green-500 mr-2"></i> 算定要件ロジック照合 (厚労省告示 第52号)';
                    document.getElementById('process-status').innerText = '加算漏れを検知中...';
                }, 1000);

                setTimeout(() => {
                    document.getElementById('step-3').classList.remove('opacity-50');
                    document.getElementById('step-3').innerHTML = '<i class="fa-solid fa-check-circle text-green-500 mr-2"></i> 埋没収益の算出';
                    document.getElementById('process-status').innerText = 'レポート作成中...';
                }, 2000);

                // Switch to Dashboard
                setTimeout(() => {
                    document.getElementById('view-processing').classList.add('hidden');
                    document.getElementById('view-dashboard').classList.remove('hidden');
                }, 3000);

            }, 800);
        }

        // Modal Logic
        function openLegalModal(name, docTitle) {
            document.getElementById('modal-doc-title').innerText = docTitle;
            document.getElementById('legal-modal').classList.remove('hidden');
            // Reset checks
            document.getElementById('check1').checked = false;
            document.getElementById('check2').checked = false;
            validateChecks();
        }

        function closeLegalModal() {
            document.getElementById('legal-modal').classList.add('hidden');
        }

        // Legal Check Validation
        function validateChecks() {
            const c1 = document.getElementById('check1').checked;
            const c2 = document.getElementById('check2').checked;
            const btn = document.getElementById('btn-download');

            if (c1 && c2) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-400', 'cursor-not-allowed');
                btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            }
        }

        // Download Simulation
        function downloadSuccess() {
            closeLegalModal();
            const toast = document.getElementById('toast');
            toast.classList.remove('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>
